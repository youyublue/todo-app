# Todo App 功能文档

本文档详细说明了 Todo 应用的所有功能和特性。

## 📋 目录

- [核心功能](#核心功能)
- [任务管理](#任务管理)
- [分类系统](#分类系统)
- [视图与筛选](#视图与筛选)
- [用户体验](#用户体验)
- [设置与管理](#设置与管理)
- [技术特性](#技术特性)

---

## 核心功能

### 1. 用户认证

#### 注册功能
- **邮箱验证**：使用正则表达式验证邮箱格式
- **密码强度**：最少 6 个字符
- **密码确认**：二次输入密码确保无误
- **邮箱重复检测**：注册前检查邮箱是否已存在
- **自动登录**：注册成功后自动登录并跳转到首页

**需求说明**：
- 邮箱必须符合标准格式（例如：user@example.com）
- 如果邮箱已被注册，显示友好提示："该邮箱已被注册，请直接登录"
- 密码少于 6 位时显示提示："密码至少需要6个字符"
- 两次密码不一致时显示提示："两次输入的密码不一致"

#### 登录功能
- **邮箱密码登录**：使用 Supabase Auth 进行身份验证
- **自动跳转**：登录成功后自动跳转到首页
- **状态持久化**：刷新页面后保持登录状态

---

## 任务管理

### 2. 任务创建

#### 快速添加
- **主输入框**：在页面顶部的输入框快速添加任务
- **回车提交**：按 Enter 键快速创建任务
- **符号识别**：
  - 输入 `！` 或 `!` 开头：自动设置优先级为"高"
  - 输入 `＃` 或 `#` 开头：自动弹出分类选择

#### 详细信息
- **任务标题**：必填，最多 200 字符
- **描述**：可选，支持多行文本
- **优先级**：低、中、高
- **分类**：从用户创建的分类中选择
- **截止日期**：使用日期选择器设置
- **重复设置**：支持周期性任务

### 3. 任务编辑（原地编辑）

#### 双击编辑模式
所有编辑功能都在任务卡片上原地完成，无需弹窗：

- **标题编辑**
  - 双击标题文字进入编辑模式
  - 输入框自动获得焦点
  - 按 Enter 保存，Esc 取消
  - 点击外部自动保存

- **描述编辑**
  - 双击描述文字进入编辑模式
  - 多行文本框支持换行
  - Ctrl+Enter 保存，Esc 取消
  - 如果没有描述，双击虚线提示可添加

- **优先级切换**
  - 点击优先级标签显示三个选项
  - 选择后立即保存
  - 颜色区分：低（蓝色）、中（黄色）、高（红色）

- **日期修改**
  - 点击日期显示日期选择器
  - 选择新日期后自动保存
  - 过期日期显示为红色

- **分类切换**
  - 点击分类标签显示所有分类
  - 选择新分类或选择"无"移除分类
  - 分类颜色与标签颜色一致

**需求说明**：
- 已完成的任务不可编辑
- 编辑状态有明显的视觉反馈（输入框、按钮）
- 所有修改立即保存到数据库
- 失去焦点时自动保存（标题、日期、描述）

### 4. 任务状态

#### 完成任务
- **复选框**：点击任务左侧的圆形复选框
- **动画效果**：完成时有弹跳动画
- **视觉反馈**：
  - 已完成任务：文字加删除线，颜色变淡
  - 复选框变蓝并显示对勾

#### 删除任务
- **删除按钮**：鼠标悬停时显示的垃圾桶图标
- **确认机制**：点击后立即删除（带淡出动画）
- **恢复机制**：当前不支持恢复

---

## 分类系统

### 5. 分类管理

#### 创建分类
- **分类名称**：必填，例如：工作、个人、学习
- **颜色选择**：
  - 10 种预设颜色快速选择
  - 视觉化颜色按钮
  - 选中颜色显示对勾标记

#### 预设颜色
1. 🔴 红色 (#ef4444)
2. 🟠 橙色 (#f97316)
3. 🟡 黄色 (#eab308)
4. 🟢 绿色 (#22c55e)
5. 🔵 蓝色 (#3b82f6)
6. 🟣 紫色 (#a855f7)
7. 🩷 粉色 (#ec4899)
8. ⚫ 灰色 (#6b7280)
9. 🤛 青色 (#06b6d4)
10. 🤎 棕色 (#a16207)

#### 删除分类
- **级联删除**：删除分类时，从所有任务中移除该分类
- **确认对话框**：删除前提示用户确认
- **不可恢复**：删除后无法恢复

---

## 视图与筛选

### 6. 智能视图

#### 收件箱（Inbox）
- 显示所有未完成任务
- 按创建时间倒序排列
- 默认首页

#### 今天（Today）
- 显示今天到期的所有任务
- 包含过期任务
- 过期任务显示为红色

#### 即将到来（Upcoming）
- 显示未来 7 天内的任务
- 按日期分组显示
- 帮助用户规划未来

#### 重要（Important）
- 显示所有高优先级任务
- 不考虑截止日期
- 快速访问重要事项

### 7. 任务分组

#### 已完成任务
- 默认折叠显示
- 显示已完成任务数量
- 点击展开/折叠
- 放置在列表底部

---

## 用户体验

### 8. 交互设计

#### 悬停效果
- **任务卡片**：鼠标悬停时轻微放大（scale 1.01）
- **删除按钮**：鼠标悬停时显示
- **提示文字**：仅在鼠标悬停时显示
  - "双击添加描述..."
  - "添加日期"按钮
  - "添加标签"按钮

#### 动画效果
- **进入动画**：新任务淡入（fadeIn）
- **删除动画**：任务淡出（fadeOut）
- **完成动画**：任务弹跳（bounce）
- **列表动画**：任务列表滑入（slideIn）
- **错峰延迟**：每个任务延迟 50ms，形成流畅的级联效果

#### 键盘快捷键
- **Enter**：保存标题编辑
- **Esc**：取消编辑
- **Ctrl+Enter**：保存描述编辑

### 9. 视觉反馈

#### 优先级颜色
- **低优先级**：蓝色背景 + "低" 文字
- **中优先级**：黄色背景 + "中" 文字
- **高优先级**：红色背景 + "高" 文字

#### 状态指示
- **过期任务**：日期显示为红色
- **已完成**：文字加删除线，透明度降低
- **编辑中**：输入框高亮边框

---

## 设置与管理

### 10. 设置页面

#### 语言设置
- **支持语言**：
  - 简体中文（zh-CN）
  - English（en-US）
- **即时生效**：选择后立即切换界面语言
- **持久化**：语言偏好保存到数据库

#### 修改密码
- **新密码**：至少 6 个字符
- **确认密码**：必须与新密码一致
- **验证反馈**：
  - 密码过短："新密码至少需要6个字符"
  - 密码不匹配："两次输入的密码不一致"
- **成功提示**：修改成功后显示 toast 通知

#### 主题切换
- **位置**：侧边栏顶部
- **切换方式**：点击太阳/月亮图标
- **持久化**：主题偏好保存到用户资料
- **深色模式优化**：
  - 日期选择器图标反色显示
  - 所有组件适配深色背景

---

## 技术特性

### 11. 数据同步

#### 实时同步
- **多设备同步**：使用 Supabase Realtime
- **即时更新**：其他设备上的修改立即反映
- **自动刷新**：检测到变化时自动获取最新数据
- **乐观更新**：操作立即反映到 UI，失败时回滚

#### 离线支持
- **本地状态**：使用 Zustand 管理本地状态
- **重连机制**：网络恢复后自动同步

### 12. 安全性

#### 认证安全
- **Row Level Security (RLS)**：数据库级别的访问控制
- **用户隔离**：每个用户只能访问自己的数据
- **会话管理**：Supabase Auth 处理会话

#### 输入验证
- **前端验证**：所有表单输入都经过验证
- **后端验证**：数据库约束和 RLS 策略
- **XSS 防护**：React 自动转义输出

### 13. 性能优化

#### 代码分割
- **懒加载**：页面组件按需加载
- **Suspense**：加载时显示骨架屏
- **路由级别分割**：每个页面独立打包

#### 状态管理
- **Zustand**：轻量级状态管理
- **选择性订阅**：组件只订阅需要的状态
- **内存优化**：避免不必要的重渲染

---

## 浏览器兼容性

### 14. 支持的浏览器

- ✅ Chrome/Edge 90+
- ✅ Firefox 88+
- ✅ Safari 14+
- ✅ 移动浏览器（iOS Safari, Chrome Mobile）

### 15. 关键依赖

```json
{
  "react": "^19.0.0",
  "typescript": "^5.6.3",
  "supabase": "^2.39.0",
  "zustand": "^4.4.7",
  "tailwindcss": "^3.4.17",
  "date-fns": "^3.0.0",
  "lucide-react": "^0.344.0"
}
```

---

## 未来计划

### 可能的改进

- [ ] 任务搜索功能
- [ ] 任务拖拽排序
- [ ] 子任务支持
- [ ] 文件附件
- [ ] 任务协作（共享任务）
- [ ] 提醒通知（浏览器通知）
- [ ] 导出功能（PDF、CSV）
- [ ] 移动应用（React Native）

---

## 更新日志

### v1.1.0 (2025-01-17)

**新增**
- ✨ 原地编辑功能（双击编辑标题、描述）
- ✨ 设置页面（密码修改、语言切换）
- ✨ 注册表单完整验证
- ✨ 邮箱重复检测
- ✨ 分类预设颜色（10 种）

**改进**
- 🎨 UI 动画优化
- 🎨 深色模式日期选择器
- 🎨 提示文字悬停显示
- 🐛 修复分类数据加载问题

**修复**
- 🐛 深色模式下日期图标不可见
- 🐛 注册后无法自动登录
- 🐛 分类列表不实时更新

---

## 技术支持

如有问题或建议，请：
- 提交 GitHub Issue
- 查看项目文档：`CLAUDE.md`
- 部署指南：`DEPLOYMENT.md`

---

*最后更新：2025-01-17*
